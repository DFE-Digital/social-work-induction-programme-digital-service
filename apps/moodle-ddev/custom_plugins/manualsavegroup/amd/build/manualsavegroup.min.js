define("local_manualsavegroup/manualsavegroup",["exports","jquery","core/notification"],(function(_exports,_jquery,_notification){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{console.log("manualsavegroup.init running"),(0,_jquery.default)("#add, #remove").hide();const form=(0,_jquery.default)("#assignform");if(!form.length)return;if((0,_jquery.default)("#batch-save-btn").length||form.append('<button id="batch-save-btn" type="submit" class="btn btn-primary mb-2">Save changes</button>'),!(0,_jquery.default)("#btn-move-add").length){const moveControls=(0,_jquery.default)('<div id="move-controls" style="margin: .5em 0; text-align:center;"><button type="button" id="btn-move-add"    class="btn btn-secondary btn-sm">Add Selected  ‚Üê</button>&nbsp;<button type="button" id="btn-move-remove" class="btn btn-secondary btn-sm">‚Üí  Remove Selected</button></div>');(0,_jquery.default)("#buttonscell").html(moveControls)}(0,_jquery.default)("#btn-move-add").on("click",(()=>{(0,_jquery.default)("#addselect option:selected").prop("selected",!1).appendTo("#removeselect")})),(0,_jquery.default)("#btn-move-remove").on("click",(()=>{(0,_jquery.default)("#removeselect option:selected").prop("selected",!1).appendTo("#addselect")}));const original=(0,_jquery.default)("#removeselect option").map(((i,o)=>o.value)).get();form.off("submit.manualsave").on("submit.manualsave",(async function(e){const trigger=e.originalEvent&&e.originalEvent.submitter;if(trigger&&"cancel"===trigger.name)return;e.preventDefault();const current=(0,_jquery.default)("#removeselect option").map(((i,o)=>o.value)).get(),toAdd=current.filter((id=>!original.includes(id))),toRemove=original.filter((id=>!current.includes(id)));console.log("üõ†Ô∏è toAdd=",toAdd,"toRemove=",toRemove);const sesskey=form.find('input[name="sesskey"]').val(),actionUrl=form.attr("action");async function postChange(buttonName,fieldName,ids){if(!ids.length)return;const data=new URLSearchParams;data.append("sesskey",sesskey),data.append(buttonName,"1"),ids.forEach((id=>data.append("".concat(fieldName,"[]"),id))),await fetch(actionUrl,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:data.toString()})}await postChange("add","addselect",toAdd),await postChange("remove","removeselect",toRemove),(0,_notification.addNotification)({message:M.util.get_string("changessaved","local_manualsavegroup"),type:"success",closebutton:!0,announce:!0}),window.location.reload()}))}}));

//# sourceMappingURL=manualsavegroup.min.js.map